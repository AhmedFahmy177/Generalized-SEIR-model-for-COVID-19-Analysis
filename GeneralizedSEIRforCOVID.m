clc;
clear;
close all;
 % select country or add your own

%Nigeria infected cases[{'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','1','1','1','1','1','1','1','1','2','2','2','2','2','2','2','2','3','8','8','12','22','30','40','44','51','65','70','89','111','131','135','174','184','210','214','232','238','254','276','288','305','318','323','343','373','407','442','493','542','627','665','665','873','981','1095','1182','1273','1337','1532','1728','1932','2170','2388','2558','2802','2950','3145','3526','3912','4151','4399','4641','4787','4971','5162','5450','5621','5959','6175','6401','6677','7016','7261','7526','7839','8068','8344','8733','8915','9302','9855','10162','10578','10819','11166','11516','11844','12233','12486','12801','13464','13873','14554','15181','15682','16085','16658','17148','17735','18480','19147','19808','20244','20919','21371','22020','22614','23298','24077','24567','25133','25694','26484','27110','27564','28167','28711','29286','29789','30249','30748','31323','31987','32558','33153','33616','34259','34854','35454','36107','36663','37225','37801','38344','38948','39539','39977','40532','41180','41804','42208','42689','43151'}];
%Oman infected cases[{'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','2','2','4','4','4','6','6','6','12','15','16','16','16','16','16','18','18','18','19','19','22','22','24','39','48','48','52','55','66','84','99','109','131','152','167','179','192','210','231','252','277','298','331','371','419','457','484','546','599','727','813','910','1019','1069','1180','1266','1410','1508','1614','1716','1790','1905','1998','2049','2131','2274','2348','2447','2483','2568','2637','2735','2903','2958','3112','3224','3399','3573','3721','4019','4341','4625','5029','5186','5379','5671','6043','6370','6794','7257','7770','7770','8118','8373','9009','9820','10423','11437','12223','12799','13537','14316','15086','16016','16882','17486','18198','18887','19954','21071','22077','23481','24524','25269','26079','26818','27670','28566','29471','31076','32394','33536','34902','36034','36953','38150','39060','40070','41194','42555','43929','45106','46178','47735','48997','50207','51725','53614','54697','56015','58179','59568','61247','62574','64193','65504','66661','68400','69887','71547','72646','73791','74858','76005','77058','77904','78569','79159','79159'}];
%Egypt infected cases
Country_infected_cases=[{'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','1','2','2','2','2','3','15','15','49','55','59','60','67','80','109','110','150','196','196','256','285','294','327','366','402','456','495','536','576','609','656','710','779','865','985','1070','1173','1322','1450','1560','1699','1794','1939','2065','2190','2350','2505','2673','2844','3032','3144','3333','3490','3659','3891','4092','4319','4534','4782','5042','5268','5537','5895','6193','6465','6813','7201','7588','7981','8476','8964','9400','9746','10093','10431','10829','11228','11719','12229','12764','13484','14229','15003','15786','16513','17265','17967','18756','19666','20793','22082','23449','24985','26384','27536','28615','29767','31115','32612','34079','35444','36829','38284','39726','41303','42980','44598','46289','47856','49219','50437','52211','53758','55233','56809','58141','59561','61130','62755','63923','65188','66754','68311','69814','71299','72711','74035','75253','76222','77279','78304','79254','80235','81158','82070','83001','83930','84843','85771','86474','87172','87775','88402','89078','89745','90413','91072','91583','92062','92482','92947'}];
%Qatar infected cases[{'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','3','3','7','8','8','8','8','15','18','24','262','262','320','337','401','439','439','452','460','470','481','494','501','526','537','549','562','590','634','693','781','835','949','1075','1325','1604','1832','2057','2210','2376','2512','2728','2979','3231','3428','3711','4103','4663','5008','5448','6015','6533','7141','7764','8525','9358','10287','11244','11921','12564','13409','14096','14872','15551','16191','17142','17972','18890','20201','21331','22520','23623','25149','26539','28272','29425','30972','32604','33969','35606','37097','38651','40481','42213','43714','45465','47207','48947','50914','52907','55262','56910','58433','60259','62160','63741','65495','67195','68790','70158','71879','73595','75071','76588','78416','79602','80876','82077','83174','84441','85462','86488','87369','88403','89579','90778','91838','92784','93663','94413','95106','96088','97003','97897','98653','99183','99799','100345','100945','101553','102110','102630','103128','103598','104016','104533','104983','105477','105898','106308','106648','107037','107430','107871','108244','108638','109036','109305'}];
%Saudi Arabia infected cases[{'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','1','5','5','5','11','15','20','21','45','86','103','103','118','171','171','274','344','392','511','562','767','900','1012','1104','1203','1299','1453','1563','1720','1885','2039','2179','2402','2605','2795','2932','3287','3651','4033','4462','4934','5369','5862','6380','7142','8274','9362','10484','11631','12772','13930','15102','16299','17522','18811','20077','21402','22753','24097','25459','27011','28656','30251','31938','33731','35432','37136','39048','41014','42925','44830','46869','49176','52016','54752','57345','59854','62545','65077','67719','70161','72560','74795','76726','78541','80185','81766','83384','85261','87142','89011','91182','93157','95748','98869','101914','105283','108571','112288','116021','119942','123308','127541','132048','136315','141234','145991','150292','154233','157612','161005','164144','167267','170639','174577','178504','182493','186436','190823','194225','197608','201801','205929','209509','213716','217108','220144','223327','226486','229480','232259','235111','237803','240474','243238','245851','248416','250920','253349','255825','258156','260394','262772','264973','266941'}];

% select country or add your own

%Nigeria Recovered cases[{'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','1','1','2','2','2','2','2','3','3','3','8','8','9','20','25','25','33','35','44','44','51','58','70','85','91','99','128','152','159','166','170','188','188','197','197','208','222','239','255','255','307','319','351','351','400','417','481','534','601','679','745','778','902','959','1070','1180','1320','1472','1594','1644','1734','1840','1907','2007','2174','2263','2311','2385','2501','2592','2697','2856','3007','3122','3240','3329','3535','3696','3826','3959','4040','4206','4351','4494','4891','5101','5220','5349','5623','5967','6307','6581','6718','6879','7109','7338','7613','7822','8253','8625','9007','9402','9746','10152','10801','11069','11462','11665','11828','12108','12373','12546','12795','13103','13447','13671','13792','13999','14292','14633','14938','15105','15333','15677','15815','16061','16559','16948','17374','18203','18764','19004','19270','19565'}];
%Oman Recovered cases[{'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','1','2','2','2','2','2','2','2','9','9','9','9','9','9','9','9','12','12','12','12','17','17','17','17','23','23','23','23','29','34','34','57','57','61','61','61','67','72','109','109','109','109','124','130','131','176','176','176','233','238','238','238','307','325','329','333','364','364','364','495','495','750','750','816','858','888','980','1025','1068','1117','1250','1250','1289','1303','1350','1436','1465','1496','1574','1661','1821','1821','1848','1933','1933','2067','2177','2177','2396','2396','2682','2682','2812','2845','3451','3451','3451','3451','3793','4152','5640','6623','7489','7530','8454','9533','11089','11797','13264','13974','14780','15552','16408','17279','17972','18520','19482','20363','21200','22422','23425','24162','25318','26169','26968','27917','29146','31000','32005','33021','34225','35255','36098','37257','37987','39038','40090','41450','42772','44004','45150','46608','47922','51349','53007','54061','55299','57028','58587','60240','61421','61421'}];
%Egypt Recovered Cases
Country_recovered_cases=[{'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','1','1','1','1','1','1','1','1','1','1','27','27','27','27','21','27','32','32','32','39','41','56','56','80','95','102','116','121','132','150','157','179','201','216','241','247','259','276','305','348','384','426','589','589','589','589','596','646','701','732','821','870','935','1004','1075','1114','1176','1236','1304','1335','1381','1460','1522','1562','1632','1730','1815','1887','1945','2002','2075','2172','2326','2486','2626','2799','2950','3172','3440','3742','3994','4217','4374','4628','4807','4900','5027','5205','5359','5511','5693','6037','6447','6827','7350','7756','8158','8538','8961','9375','9786','10289','10691','11108','11529','11931','12329','12730','13141','13528','13928','14327','14736','15133','15535','15935','16338','16737','17140','17539','17951','18460','18881','19288','19690','20103','20726','21238','21718','22241','22753','23274','23876','24419','24975','25544','26135','26691','27302','27868','28380','28924','29473','30075','31066','31970','32903','33831','34838','35959'}];
%Qatar Recovery cases[{'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','4','4','4','4','4','4','10','27','33','33','41','41','43','43','45','48','51','62','71','72','93','109','123','131','150','178','206','227','247','275','334','373','406','415','464','510','518','555','614','689','750','809','929','1012','1066','1134','1243','1372','1436','1534','1664','1810','1924','2070','2286','2370','2449','2753','2840','3019','3143','3356','3546','3788','4370','4899','5634','6600','7288','7893','8513','9170','10363','11844','13283','15399','20604','25839','30290','33437','36036','37542','39468','40935','42527','44338','45935','47569','49413','51331','53296','55252','56898','58681','60461','62172','63642','65409','66763','68319','69956','71501','73083','74544','76072','77225','78702','80170','81564','83965','86597','88583','90387','92284','93898','94903','96107','97272','98233','98934','99743','100627','101160','101637','102168','102597','103023','103377','103782','104191','104641','105018','105420','105750','106024'}];
%Saudi Arabia Recovery cases[{'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','1','1','1','1','2','6','6','6','8','16','16','16','28','29','33','35','37','66','115','165','264','328','351','420','488','551','615','631','666','685','720','761','805','889','931','990','1049','1329','1398','1490','1640','1812','1925','2049','2215','2357','2531','2784','2953','3163','3555','3765','4134','4476','5431','6783','7798','9120','10144','11457','12737','15257','17622','19051','21869','23666','25722','28748','31634','33478','36040','39003','41236','43520','45668','48450','51022','54553','57013','58883','62442','64306','65790','68159','68965','70616','71791','72817','74524','76339','77954','80019','81029','82548','84720','87890','89540','91662','93915','95764','98917','101130','105175','109885','112797','117882','120471','122128','124755','127118','130766','132760','137669','140614','143256','145236','149634','154839','158050','161096','163026','165396','167138','169842','177560','183048','187622','191161','194218','197735','203259','207259','210398','213490','215731','217782','220323'}];
% select country or add your own

%Nigeria Death cases[{'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','1','1','1','1','1','2','2','2','2','4','4','5','5','6','6','7','7','10','10','10','11','12','13','17','19','21','22','22','28','31','32','35','40','40','44','51','58','68','85','87','93','98','103','107','117','128','143','150','158','164','167','171','176','182','191','192','200','211','221','221','226','233','249','254','259','261','273','287','299','314','315','323','333','342','354','361','365','382','387','399','407','420','424','455','469','475','487','506','518','525','533','542','549','554','558','565','573','590','603','616','628','634','645','654','669','684','689','709','724','740','744','754','760','769','772','778','789','801','805','813','833','845','856','858','860','868','873','878','879'}];
%OmanDeath cases[{'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','1','1','2','2','2','2','2','3','3','3','4','4','4','4','4','6','6','7','7','8','8','9','10','10','10','10','10','10','11','11','12','12','12','13','13','15','16','17','17','17','17','17','18','20','21','22','25','27','30','31','34','36','37','37','37','39','40','40','42','49','50','59','67','67','72','72','75','81','83','84','89','96','99','104','108','114','116','119','125','128','131','137','140','142','144','153','159','163','169','176','185','188','193','203','213','218','224','233','236','244','248','257','259','273','281','290','298','308','318','326','337','349','355','359','371','384','393','402','412','421','421'}];
%Egypt Death cases
Country_deaths_cases=[{'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','1','1','1','2','2','2','2','4','6','6','8','10','14','19','20','21','24','30','36','40','41','46','52','58','66','71','78','85','94','103','118','135','146','159','164','178','183','196','205','224','239','250','264','276','287','294','307','317','337','359','380','392','406','415','429','436','452','469','482','503','514','525','533','544','556','571','592','612','630','645','659','680','696','707','735','764','783','797','816','845','879','913','959','1005','1052','1088','1126','1166','1198','1237','1271','1306','1342','1377','1422','1484','1575','1672','1766','1850','1938','2017','2106','2193','2278','2365','2450','2533','2620','2708','2789','2872','2953','3034','3120','3201','3280','3343','3422','3489','3564','3617','3702','3769','3858','3935','4008','4067','4120','4188','4251','4302','4352','4399','4440','4480','4518','4558','4606','4652','4691'}];
%Qatar Death cases[{'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','1','2','2','3','3','3','4','4','6','6','6','6','6','7','7','7','7','7','7','8','8','9','9','10','10','10','10','10','10','10','10','10','12','12','12','12','12','12','12','12','13','14','14','14','14','14','14','15','15','15','15','16','17','19','21','23','26','28','30','33','36','36','38','40','43','45','45','49','51','54','57','62','66','69','70','70','73','76','80','82','86','93','94','98','99','99','104','106','109','110','110','113','113','115','118','121','123','128','133','134','138','142','146','146','147','149','150','151','152','153','154','157','159','160','163','164','164','164','165'}];
%Saudi arabia Death cases[{'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','2','3','3','4','8','8','10','16','21','25','29','34','38','41','41','44','47','52','59','65','73','79','83','87','92','97','103','109','114','121','127','136','139','144','152','157','162','169','176','184','191','200','209','219','229','239','246','255','264','273','283','292','302','312','320','329','339','351','364','379','390','399','411','425','441','458','480','503','525','549','579','611','642','676','712','746','783','819','857','893','932','972','1011','1052','1091','1139','1184','1230','1267','1307','1346','1387','1428','1474','1511','1551','1599','1649','1698','1752','1802','1858','1916','1968','2017','2059','2100','2151','2181','2223','2243','2283','2325','2370','2407','2447','2486','2523','2557','2601','2635','2672','2703','2733'}];

I = str2double(Country_infected_cases(80:187))-str2double(Country_recovered_cases(80:187))-str2double(Country_deaths_cases(80:187)); %choosing which segment of the data to operate on note that to get the active cases you must subtract deaths and recovered from cumulative cases 
R = str2double(Country_recovered_cases(80:187)); %choosing which segment of the data to operate on 
De = str2double(Country_deaths_cases(80:187));   %%choosing which segment of the data to operate on 
m = length(I); %length of the segment of the data sets
h = 2^-7; %time step 
t=[1:m]; %for plotting data sets as scattering plots
alpha = [1,1,1,1,1,1,1]; %%order of diffrantiation (for more info R.Garrappa, Numerical Solution of Fractional Differential Equations: A Survey and a Software Tutorial, Mathematics 2018, 6 (2), 16 doi: 10.3390 / math6020016 ( download pdf file );
%Select population of the country or add your own
%N=196e6;%population of the Country under investigation (Nigeria)
%N=4.83e6;%population of the Country under investigation (Oman)
%N=33.7e6; %population of the Country under investigation (Saudi Arabia)
%N=2.78e6;  %%population of the Country under investigation (Qatar)
N=100e6;   %population of the Country under investigation  (Egypt)
f_fun = @(t,y,par) [-(par(1) /N)*y(1)*y(3) - par(2)* y(1); 
                              (par(1) /N)*y(1)*y(3) - par(3) *y(2);  
                               par(3) * y(2)        - par(4)*y(3) ; 
                               par(4) * y(3) - par(5)*(1-exp(-par(6)*t)) * y(4) - par(7)*exp(-par(8)*t) * y(4); 
                               par(5) *(1-exp(-par(6)*t))* y(4); 
                               par(7)*exp(-par(8)*t) * y(4); 
                               par(2) * y(1)] ;   %Equations of the model (modified SEIR) check [1] in readme file                    
                           
 
%intial values for Egypt
      yy0=[84998827 -3188299.61490316 ; 3141 146.531795370797 ; 1047 220.088533140553 ; 942.3 20; 102 0.12 ; 24 1.7; 15000126 3187910.81482184];
%intial values for Qatar      
      %yy0 = [2360488;1823.20000000000;2279;2051.10000000000;227;6;417233];
%intial values for Saudi Arabia
     %yy0 =[28641349;2335.20000000000;2919;2627.10000000000;685;47;5055732];
%intial values for Oman and Nigeria (good estimation for any generic country with R0 around 3)   
      %yy0=[ 0.85*N-(4.9*I(1)+2*R(1)+2*De(1))  ; 3*I(1); I(1) ; .9*I(1); R(1) ; De(1) ; R(1)+De(1)+.15*N ];
       
t0=1; T=1000; %intial and final vlaues of simulation in days
%select what paramters to use 
%Opt_Par=fitFun(I,R,De)% to find the optimized paramters for the model for a given country (you plug in the intial guesses in the function file manually
%optimized paramters for Niageria (to save you the runtime)
%Opt_Par =[ 0.1796    0.0046    0.5230    0.0951    0.0193    3.8281    0.0041    0.0215];

%optimized paramters for Oman (to save you the runtime)
%Opt_Par=[0.1714    0.0208    1.9461    0.0127    0.2986    0.0025    0.0003   0.0005];

%optimized paramters for Egypt (to save you the runtime)
Opt_Par =[0.3059    0.0351    0.1198    0.0187    0.6767    0.0003 0.0018 0.0021];

%optimized paramters for Qatar  (to save you the runtime)
%Opt_Par= [0.8404    0.0530    0.0716    0.0862    4.7972    0.0002    0.00008   -0.001]

%optimized paramters for Saudia Arabia (to save you the runtime)
%Opt_Par= [    0.23767    0.0025    1.7163    0.1600    0.0623    0.0789    0.0007   -0.0001];

[t, y] = fde_pi1_ex(alpha,f_fun,t0,T,yy0,h,Opt_Par); %solving the system of ODEs


%%ploting results
n=[1:m];
t = datetime(t + 737890,'ConvertFrom','datenum'); 
n = datetime(n + 737890,'ConvertFrom','datenum');
figure %total cases  
scatter(n, I+R+De);
hold on
    plot(t,y(4,:)+y(5,:)+y(6,:));
 hold on
grid on
xlabel('Days') 
ylabel('Number of Total Cases')
legend('Model','Real Data')
hold off
figure %active cases
scatter(n, I);
hold on
    plot(t,y(4,:));
 hold on
grid on
xlabel('Days') 
ylabel('Number of Active Cases')
legend('Model','Real Data')
hold off
figure %recovered cases
hold on
scatter(n, R);
hold on 
    plot(t,y(5,:));
    hold on
grid on
xlabel('Days') 
ylabel('Number of Recovered Cases')
legend('Model','Real Data')
hold off
figure %Death cases 
hold on
scatter(n, De); 

hold on 

    plot(t,y(6,:));
    hold on
grid on
xlabel('Days') 
ylabel('Number of Death Cases')
legend('Model','Real Data')
hold off
  Q_model = y(4,:);
  R_model = y(5,:);
  D_model = y(6,:);
figure%collective behaviour 
hold on
plot(t,Q_model);
scatter(n, I);
plot(t,R_model);
scatter(n, R);
plot(t,D_model);
scatter(n, De);
grid on
legend('Active Cases after fitting', 'Active Cases data','Recorved after fitting', 'Recorved data','Deaths after fitting', 'Deaths data'  );
xlabel('Days') 
ylabel('Number of Cases')
hold off



